---
title: "serofoi"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{serofoi}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r cleaning, include = FALSE, echo = TRUE}
library(serofoi)
rownames(mydata) <- NULL 
data_test <- prepare_data(mydata)

```

# Use cases for the models defined in the *serofoi* package

**serofoi** is an R package that allows estimations of the Force-of-Infection from a population based serosurvey data.

## **Sero-survey data**

Surveys had to meet all of the following inclusion criteria:

1.  Be population-based (not hospital based)

2.  Specify individuals' age or age group

3.  Indicate diagnostic test(s) used. The current version of serofoi only applies to *IgG* antibodies)

4.  Identify the location and date (year) of sample collection

## Model assumptions

Current version of **serofoi** includes the following assumptions on the underlying biological process:

-   The Force-of-infection (FOI) is estimated using a catalytic model

-   There is no sero-reversion (from positive to negative). It means IgG antibodies are life-long duration with no waning immunity. This may not be the case for several pathogens. This feature is planned for future versions of **serofoi.**

-   There is no age-dependency. This may not be the case for several pathogens. This feature is planned for future versions of **serofoi.**

-   There is no impact from migration processes in the sampled population

-   There are no differences in the mortality rate of infected versus susceptible individuals

## **Constant vs Time-varying** FoI models

::: {.alert .alert-primary}
NOTE: Running the the *serofoi* models for the first time on your local computer make take a few minutes while the *rstan* code is compiled locally. Afterwards, no further compilation is needed locally.
:::

#### Constant Force-of-Infection (endemic model)

For the *endemic model* a small number of iterations is enough for achieving convergence, as it only fits one parameter (the constant FoI) from a binomial distribution.

For this model, the rate of infection acquisition―rate of seroconversion―is constant over time, and infection (sero)prevalence will increase monotonically with age as cumulative exposure increases.

Denoting *n*(*a,t*) the number of seropositive individuals of age *a* at time *t, N* the serosurvey sample size, and *P*(*a,t*) the underlying seroprevalence at age *a* at time *t*, we assumed that the number of seropositive subjects follows a Binomial distribution *n*(*a,t*)\~*B*(*N,P*(*a,t*)). For force-of-infection (FOI) that is constant over time, denoted *λ*, we modelled seroprevalence for age *a* in year *t* (i.e. the time when the serosurvey occurred) as:

    $$
    P(a,t) = 1−exp(−λa)
    $$

```{r model_1, include = TRUE, errors = FALSE, warning = FALSE, message = FALSE }
model_1 <- run_model(model_data = data_test,
                     model_name = "constant_foi_bi",
                     n_iters = 500, 
                     n_thin = 2)

```

#### Time-varying Force-of-Infection

For the time-varying FOI model, FoI values are estimated from a binomial distribution. The sero-prevalence as age a can be expressed as:

    $$
    𝑃(𝑎,𝑡)=1−exp(−∑𝑡𝑖=𝑡−𝑎+1𝜆𝑖)
    $$

```{r model_2, include = TRUE, errors = FALSE, warning = FALSE, message = FALSE }
model_2 <- run_model(model_data = data_test,
                     model_name = "continuous_foi_normal_bi",
                     n_iters = 1500, 
                     n_thin = 2)
```

## Fitting process

Models are implemented in **RStan** using the No-U-Turn sampler, a type of Hamiltonian Monte Carlo sampling. After convergence, the best-fitting models can be selected based on the expected log predictive density for an out-of-sample data point (elpd) [[30](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8205173/#pntd.0009418.ref030),[31](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8205173/#pntd.0009418.ref031)].

## Case 1. Chagas disease (endemic disease)

```{r ex, include = TRUE}



```

## Case 2. Alphaviruses (epidemic disease)

## References
